<!DOCTYPE html><html lang="en"><head><meta charSet="utf-8"/><meta http-equiv="x-ua-compatible" content="ie=edge"/><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"/><meta name="theme-color" content="#663399"/><meta data-react-helmet="true" name="twitter:description" content="Wilson likes to kick back and create things. Sometimes they are Magic: The Gathering decks, other times it&#x27;s silly websites like this to be able to point to and say &quot;I did that&quot;."/><meta data-react-helmet="true" name="twitter:title" content="Fun with Types: Units of Measure - Wilson Gearld Mead III&#x27;s Blog Posts"/><meta data-react-helmet="true" name="twitter:creator" content="@rangoric"/><meta data-react-helmet="true" name="twitter:card" content="summary"/><meta data-react-helmet="true" property="og:type" content="website"/><meta data-react-helmet="true" property="og:description" content="Wilson likes to kick back and create things. Sometimes they are Magic: The Gathering decks, other times it&#x27;s silly websites like this to be able to point to and say &quot;I did that&quot;."/><meta data-react-helmet="true" property="og:title" content="Fun with Types: Units of Measure - Wilson Gearld Mead III&#x27;s Blog Posts"/><meta data-react-helmet="true" name="description" content="Wilson likes to kick back and create things. Sometimes they are Magic: The Gathering decks, other times it&#x27;s silly websites like this to be able to point to and say &quot;I did that&quot;."/><meta name="generator" content="Gatsby 4.7.2"/><style data-href="/styles.dd886e83f45950ff3089.css" data-identity="gatsby-global-css">html{-ms-text-size-adjust:100%;-webkit-text-size-adjust:100%;font-family:sans-serif}body{-webkit-font-smoothing:antialiased;-moz-osx-font-smoothing:grayscale;margin:0}article,aside,details,figcaption,figure,footer,header,main,menu,nav,section,summary{display:block}audio,canvas,progress,video{display:inline-block}audio:not([controls]){display:none;height:0}progress{vertical-align:baseline}[hidden],template{display:none}a{-webkit-text-decoration-skip:objects;background-color:transparent}a:active,a:hover{outline-width:0}abbr[title]{border-bottom:none;text-decoration:underline;-webkit-text-decoration:underline dotted;text-decoration:underline dotted}b,strong{font-weight:inherit;font-weight:bolder}dfn{font-style:italic}h1{font-size:2em;margin:.67em 0}mark{background-color:#ff0;color:#000}small{font-size:80%}sub,sup{font-size:75%;line-height:0;position:relative;vertical-align:baseline}sub{bottom:-.25em}sup{top:-.5em}img{border-style:none}svg:not(:root){overflow:hidden}code,kbd,pre,samp{font-family:monospace,monospace;font-size:1em}figure{margin:1em 40px}hr{box-sizing:content-box;height:0;overflow:visible}button,input,optgroup,select,textarea{font:inherit;margin:0}optgroup{font-weight:700}button,input{overflow:visible}button,select{text-transform:none}[type=reset],[type=submit],button,html [type=button]{-webkit-appearance:button}[type=button]::-moz-focus-inner,[type=reset]::-moz-focus-inner,[type=submit]::-moz-focus-inner,button::-moz-focus-inner{border-style:none;padding:0}[type=button]:-moz-focusring,[type=reset]:-moz-focusring,[type=submit]:-moz-focusring,button:-moz-focusring{outline:1px dotted ButtonText}fieldset{border:1px solid silver;margin:0 2px;padding:.35em .625em .75em}legend{box-sizing:border-box;color:inherit;display:table;max-width:100%;padding:0;white-space:normal}textarea{overflow:auto}[type=checkbox],[type=radio]{box-sizing:border-box;padding:0}[type=number]::-webkit-inner-spin-button,[type=number]::-webkit-outer-spin-button{height:auto}[type=search]{-webkit-appearance:textfield;outline-offset:-2px}[type=search]::-webkit-search-cancel-button,[type=search]::-webkit-search-decoration{-webkit-appearance:none}::-webkit-input-placeholder{color:inherit;opacity:.54}::-webkit-file-upload-button{-webkit-appearance:button;font:inherit}html{box-sizing:border-box;font:112.5%/1.45em georgia,serif;overflow-y:scroll}*,:after,:before{box-sizing:inherit}body{word-wrap:break-word;-ms-font-feature-settings:"kern","liga","clig","calt";-webkit-font-feature-settings:"kern","liga","clig","calt";font-feature-settings:"kern","liga","clig","calt";color:rgba(0,0,0,.8);font-family:georgia,serif;font-kerning:normal;font-weight:400}img{margin:0 0 1.45rem;max-width:100%;padding:0}h1{font-size:2.25rem}h1,h2{text-rendering:optimizeLegibility;color:inherit;font-family:-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Oxygen,Ubuntu,Cantarell,Fira Sans,Droid Sans,Helvetica Neue,sans-serif;font-weight:700;line-height:1.1;margin:0 0 1.45rem;padding:0}h2{font-size:1.62671rem}h3{font-size:1.38316rem}h3,h4{text-rendering:optimizeLegibility;color:inherit;font-family:-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Oxygen,Ubuntu,Cantarell,Fira Sans,Droid Sans,Helvetica Neue,sans-serif;font-weight:700;line-height:1.1;margin:0 0 1.45rem;padding:0}h4{font-size:1rem}h5{font-size:.85028rem}h5,h6{text-rendering:optimizeLegibility;color:inherit;font-family:-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Oxygen,Ubuntu,Cantarell,Fira Sans,Droid Sans,Helvetica Neue,sans-serif;font-weight:700;line-height:1.1;margin:0 0 1.45rem;padding:0}h6{font-size:.78405rem}hgroup{margin:0 0 1.45rem;padding:0}ol,ul{list-style-image:none;list-style-position:outside;margin:0 0 1.45rem 1.45rem;padding:0}dd,dl,figure,p{margin:0 0 1.45rem;padding:0}pre{word-wrap:normal;background:rgba(0,0,0,.04);border-radius:3px;font-size:.85rem;line-height:1.42;margin:0 0 1.45rem;overflow:auto;padding:1.45rem}table{border-collapse:collapse;font-size:1rem;line-height:1.45rem;width:100%}fieldset,table{margin:0 0 1.45rem;padding:0}blockquote{margin:0 1.45rem 1.45rem;padding:0}form,iframe,noscript{margin:0 0 1.45rem;padding:0}hr{background:rgba(0,0,0,.2);border:none;height:1px;margin:0 0 calc(1.45rem - 1px);padding:0}address{margin:0 0 1.45rem;padding:0}b,dt,strong,th{font-weight:700}li{margin-bottom:.725rem}ol li,ul li{padding-left:0}li>ol,li>ul{margin-bottom:.725rem;margin-left:1.45rem;margin-top:.725rem}blockquote :last-child,li :last-child,p :last-child{margin-bottom:0}li>p{margin-bottom:.725rem}code,kbd,samp{font-size:.85rem;line-height:1.45rem}abbr,abbr[title],acronym{border-bottom:1px dotted rgba(0,0,0,.5);cursor:help}abbr[title]{text-decoration:none}td,th,thead{text-align:left}td,th{font-feature-settings:"tnum";-moz-font-feature-settings:"tnum";-ms-font-feature-settings:"tnum";-webkit-font-feature-settings:"tnum";border-bottom:1px solid rgba(0,0,0,.12);padding:.725rem .96667rem calc(.725rem - 1px)}td:first-child,th:first-child{padding-left:0}td:last-child,th:last-child{padding-right:0}code,tt{background-color:rgba(0,0,0,.04);border-radius:3px;font-family:SFMono-Regular,Consolas,Roboto Mono,Droid Sans Mono,Liberation Mono,Menlo,Courier,monospace;padding:.2em 0}pre code{background:none;line-height:1.42}code:after,code:before,tt:after,tt:before{content:" ";letter-spacing:-.2em}pre code:after,pre code:before,pre tt:after,pre tt:before{content:""}@media only screen and (max-width:480px){html{font-size:100%}}</style><title data-react-helmet="true">Fun with Types: Units of Measure - Wilson Gearld Mead III&#x27;s Blog Posts | Wilson&#x27;s Personal Website</title><style>.gatsby-image-wrapper{position:relative;overflow:hidden}.gatsby-image-wrapper picture.object-fit-polyfill{position:static!important}.gatsby-image-wrapper img{bottom:0;height:100%;left:0;margin:0;max-width:none;padding:0;position:absolute;right:0;top:0;width:100%;object-fit:cover}.gatsby-image-wrapper [data-main-image]{opacity:0;transform:translateZ(0);transition:opacity .25s linear;will-change:opacity}.gatsby-image-wrapper-constrained{display:inline-block;vertical-align:top}</style><noscript><style>.gatsby-image-wrapper noscript [data-main-image]{opacity:1!important}.gatsby-image-wrapper [data-placeholder-image]{opacity:0!important}</style></noscript><script type="module">const e="undefined"!=typeof HTMLImageElement&&"loading"in HTMLImageElement.prototype;e&&document.body.addEventListener("load",(function(e){if(void 0===e.target.dataset.mainImage)return;if(void 0===e.target.dataset.gatsbyImageSsr)return;const t=e.target;let a=null,n=t;for(;null===a&&n;)void 0!==n.parentNode.dataset.gatsbyImageWrapper&&(a=n.parentNode),n=n.parentNode;const o=a.querySelector("[data-placeholder-image]"),r=new Image;r.src=t.currentSrc,r.decode().catch((()=>{})).then((()=>{t.style.opacity=1,o&&(o.style.opacity=0,o.style.transition="opacity 500ms linear")}))}),!0);</script><link rel="icon" href="/favicon-32x32.png?v=4a9773549091c227cd2eb82ccd9c5e3a" type="image/png"/><link rel="manifest" href="/manifest.webmanifest" crossorigin="anonymous"/><link rel="apple-touch-icon" sizes="48x48" href="/icons/icon-48x48.png?v=4a9773549091c227cd2eb82ccd9c5e3a"/><link rel="apple-touch-icon" sizes="72x72" href="/icons/icon-72x72.png?v=4a9773549091c227cd2eb82ccd9c5e3a"/><link rel="apple-touch-icon" sizes="96x96" href="/icons/icon-96x96.png?v=4a9773549091c227cd2eb82ccd9c5e3a"/><link rel="apple-touch-icon" sizes="144x144" href="/icons/icon-144x144.png?v=4a9773549091c227cd2eb82ccd9c5e3a"/><link rel="apple-touch-icon" sizes="192x192" href="/icons/icon-192x192.png?v=4a9773549091c227cd2eb82ccd9c5e3a"/><link rel="apple-touch-icon" sizes="256x256" href="/icons/icon-256x256.png?v=4a9773549091c227cd2eb82ccd9c5e3a"/><link rel="apple-touch-icon" sizes="384x384" href="/icons/icon-384x384.png?v=4a9773549091c227cd2eb82ccd9c5e3a"/><link rel="apple-touch-icon" sizes="512x512" href="/icons/icon-512x512.png?v=4a9773549091c227cd2eb82ccd9c5e3a"/><style data-styled="" data-styled-version="5.3.3"></style><link as="script" rel="preload" href="/webpack-runtime-2eff1631cdf3f2eb40d3.js"/><link as="script" rel="preload" href="/framework-a41a30b6052f08f79325.js"/><link as="script" rel="preload" href="/app-d3640f62092642571bce.js"/><link as="script" rel="preload" href="/component---src-pages-blog-fun-with-types-units-of-measure-mdx-4df816fa74c3b8ffb6f0.js"/><link as="fetch" rel="preload" href="/page-data/blog/fun-with-types-units-of-measure/page-data.json" crossorigin="anonymous"/><link as="fetch" rel="preload" href="/page-data/sq/d/3649515864.json" crossorigin="anonymous"/><link as="fetch" rel="preload" href="/page-data/sq/d/63159454.json" crossorigin="anonymous"/><link as="fetch" rel="preload" href="/page-data/app-data.json" crossorigin="anonymous"/></head><body><div id="___gatsby"><div style="outline:none" tabindex="-1" id="gatsby-focus-wrapper"><header style="background:rebeccapurple;margin-bottom:1.45rem"><div style="margin:0 auto;max-width:960px;padding:1.45rem 1.0875rem"><h1 style="margin:0"><a style="color:white;text-decoration:none" href="/">Wilson&#x27;s Personal Website</a></h1></div></header><div style="margin:0 auto;max-width:960px;padding:0 1.0875rem 1.45rem"><main><h1>Fun with Types: Units of Measure</h1><p>Units of measure are a way to tell 2 things of the same type apart in code.</p><p>Or another way, you can&#x27;t subtract 32B0F from 6&#x27; it just doesn&#x27;t make sense. You see those 2 numbers and you know you can&#x27;t do that. So let&#x27;s make the code know that.</p><h2>In TypeScript?!</h2><p>Yeah, I know F# and other languages in that family have actual support for Units of Measure, but I&#x27;m mostly in TypeScript land and needed them.</p><p>And TypeScript doesn&#x27;t <em>really</em> support it.</p><h2>Ok Convince Me...</h2><p>Let&#x27;s devise a horrible example:</p><pre><code class="language-typescript">interface IItem {
  id: string;
  name: string;
  description: string;
}

interface ICharacter {
  id: string;
  name: string;
  description: string;
  items: string[]; // Item IDs
}
</code></pre><p>Now the <code>name</code> and <code>description</code> of each of those are the same type. You would use them the same way, might compare them, and might add them together in some way.</p><p>But those <code>id</code> values? Nope. Those are really Item id and Character id. You can&#x27;t add a character id to a the item list on a character <em>but the code will let you</em>. This is what we want to deal with.</p><p>Right now this works:</p><pre><code class="language-typescript">const item = { id: &quot;xyz&quot; } as IItem;
const character = { id: &quot;xyz&quot; } as ICharacter;

const areEqual = item.id === character.id; // is true
</code></pre><h2>That does suck, but what can we do?</h2><p><em>Units of Measure</em> can help solve this problem.</p><pre><code class="language-typescript">// Our base Unit of Measure Type
//  Not having the extends string on the U parameter is possible
//  But nullable types don&#x27;t work because all nullable types can be null.
type UOM&lt;T, U extends string&gt; = T &amp; { __UOM: U };
// We want to be able to have string IDs that have a unit of measure
type ID&lt;U extends string&gt; = UOM&lt;string, U&gt;;

interface IItem {
  id: ID&lt;&quot;Item&quot;&gt;;
  name: string;
  description: string;
}

interface ICharacter {
  id: ID&lt;&quot;Character&quot;&gt;;
  name: string;
  description: string;
  items: ID&lt;&quot;Item&quot;&gt;[];
}
</code></pre><p>Now that we have this set up, magic happens:</p><pre><code class="language-typescript">describe(&quot;Given 2 items with different types on their ID&quot;, () =&gt; {
  const item = { id: &quot;xyz&quot; } as IItem;
  const character: ICharacter = {
    id: &quot;xyz&quot; as ID&lt;&quot;Character&quot;&gt;,
    items: [],
    name: &quot;&quot;,
    description: &quot;&quot;,
  };

  it(&quot;when we compare their ids, it turns out false... I mean true.&quot;, () =&gt; {
    expect(item.id === character.id).toBeTruthy(); // TypeScript Error!
  });
  it(&quot;when I try and add a character to an item id list, it fails&quot;, () =&gt; {
    character.items.push(&quot;duh&quot;); // This won&#x27;t compile.
    character.items.push(charcater.id); // Nor will this.
    character.items.push(item.id); // this works fine!
  });
});
</code></pre><h3>Why This works</h3><p>It&#x27;s faking out the type system. The <code>&amp; { __UOM:U}</code> is the magical part. When we use <code>as</code> we tell TypeScript that this object really is this type. And since there is enough overlap between <code>string</code> and <code>string &amp; {__UOM:&#x27;Character&#x27;}</code> TypeScript allows it.</p><p>However, that <code>&amp; {__UOM:&#x27;Character&#x27;}</code> prevents it from matching <code>&amp; {__UOM:&#x27;Item&#x27;}</code> as they can&#x27;t match. While we didn&#x27;t define the <!-- -->_<!-- -->UOM property, it&#x27;s part of the type, so TypeScript will enforce it.</p><h2>The tests ran fine</h2><p>Yeah the jest compiler doesn&#x27;t seem to care. But if you clone/open <a href="https://github.com/Rangoric/rangoric.github.io">my repository</a> in VSCode, you will see that there are TS errors <code>/src/examples/uom.test.ts</code> that a normal build will catch.</p><h2>Isn&#x27;t that a lot of Strings that will bulk up your code</h2><p>TypeScript type erasure will actually remove all type information (in this case, anything outside of the string of the ID) during compilation. The tests above look like this when compiled.</p><pre><code class="language-javascript">describe(&quot;Given 2 items with different types on their ID&quot;, () =&gt; {
  const item = { id: &quot;xyz&quot; };
  const character = { id: &quot;xyz&quot;, items: [], name: &quot;&quot;, description: &quot;&quot; };

  it(&quot;when we compare their ids, it turns out false... I mean true.&quot;, () =&gt; {
    expect(item.id === character.id).toBeTruthy();
  });
  it(&quot;when I try and add a character to an item id list, it fails&quot;, () =&gt; {
    character.items.push(&quot;duh&quot;);
    character.items.push(charcater.id);
    character.items.push(item.id);
  });
});
</code></pre><p>Type Erasure is also why jest will compile the tests just fine and run them.</p><p>Moving on...</p><p>The power of this picks up as you use it. Let&#x27;s extend the character some</p><pre><code class="language-typescript">interface IRPGCharacter {
  id: ID&lt;&quot;RPGCharacter&quot;&gt;;
  attributes: {
    strength: UOM&lt;number, &quot;strength&quot;&gt;;
    dexterity: UOM&lt;number, &quot;dexterity&quot;&gt;;
  };
}

describe(&quot;Given a character with strength and dexterity&quot;, () =&gt; {
  const character = {
    id: &quot;xyz&quot;,
    attributes: { strength: 10, dexterity: 10 },
  } as IRPGCharacter;
  it(&quot;when we compare them, then it fails like the ids&quot;, () =&gt; {
    expect(
      character.attributes.strength === character.attributes.dexterity
    ).toBeTruthy();
  });
});
</code></pre><p>Again type errors start yelling at you.</p><pre><code class="language-typescript">const getMaxLift = (x: UOM&lt;number, &quot;strength&quot;&gt;) =&gt; {
  return x * 1000;
};

describe(&quot;Given a character with strength&quot;, () =&gt; {
  const character = {
    id: &quot;xyz&quot;,
    attributes: { strength: 10, dexterity: 10 },
  } as IRPGCharacter;
  it(&quot;when we get their max lift, then we cant use dexterity&quot;, () =&gt; {
    const maxLift = getMaxLift(character.attributes.dexterity);
  });
});
</code></pre><p>More yelling at you</p><h2>Wait a second, you just used strength as a number</h2><p>Yes, yes I did. As soon as you go to use a unit of measure as only it&#x27;s base type, it&#x27;s allowed. This is because units of measure are to stop 2 different units from being adjusted with each other, but can be adjusted by a neutral unit.</p><p>The usual example of units of measure is:</p><pre><code class="language-typescript">const time = 5 as UOM&lt;number, &quot;seconds&quot;&gt;;
const distance = 10 as UOM&lt;number, &quot;meters&quot;&gt;;
</code></pre><p>You could multiply time by 5, which means it takes 5 times as long. So units of measure stop types from colliding with each other, but the base type is can still intermix with. You could make it safer by having UOM on those multipliers also, but it&#x27;s not as important. <em>Unless you have a bug in that area</em>. Adding the units you expect something to be when you have a bug will help make sure the types you expect are what you are dealing with.</p><h2>Ok, I can think of a good use for this</h2><p>Absolutely, so much of the time, we are dealing with complex types that end up as either number of string. This lets you add a bit of meat to those types. And with type erasure, it comes with very little cost. I&#x27;ve found it useful for dealing with bugs with different IDs (hence using that as an example) because they are all strings, and with this I can make them different under the TypeScript hood. Cause I mean item.id starts looking the same the more you use it.</p><h2>Read More</h2><p>This code is based on how F# does <a href="https://docs.microsoft.com/en-us/dotnet/fsharp/language-reference/units-of-measure">units of measure</a>.</p><p>An alternative, that is especially useful if you are doing more math, are the Unit capabilities of <a href="https://mathjs.org/docs/datatypes/units.html">math.js</a>.</p></main><footer>© <!-- -->2022<!-- -->, Built with<!-- --> <a href="https://www.gatsbyjs.org">Gatsby</a></footer></div></div><div id="gatsby-announcer" style="position:absolute;top:0;width:1px;height:1px;padding:0;overflow:hidden;clip:rect(0, 0, 0, 0);white-space:nowrap;border:0" aria-live="assertive" aria-atomic="true"></div></div><script id="gatsby-script-loader">/*<![CDATA[*/window.pagePath="/blog/fun-with-types-units-of-measure/";window.___webpackCompilationHash="f640dbeea0127557cb7d";/*]]>*/</script><script id="gatsby-chunk-mapping">/*<![CDATA[*/window.___chunkMapping={"polyfill":["/polyfill-4718f0fec20e0d09d7f5.js"],"app":["/app-d3640f62092642571bce.js"],"component---src-pages-404-js":["/component---src-pages-404-js-cc9db735cca08560b3c7.js"],"component---src-pages-about-me-index-mdx":["/component---src-pages-about-me-index-mdx-ba1ac12a17706bb35371.js"],"component---src-pages-base-srd-index-mdx":["/component---src-pages-base-srd-index-mdx-01071b94e3b25aeed1db.js"],"component---src-pages-blog-fun-with-types-units-of-measure-mdx":["/component---src-pages-blog-fun-with-types-units-of-measure-mdx-4df816fa74c3b8ffb6f0.js"],"component---src-pages-blog-index-mdx":["/component---src-pages-blog-index-mdx-f2950a37855d367b73ed.js"],"component---src-pages-index-tsx":["/component---src-pages-index-tsx-ce2f519dbfbb29e3cb83.js"],"component---src-pages-magic-index-mdx":["/component---src-pages-magic-index-mdx-1e9907fa00318d1baca4.js"],"component---src-pages-resume-index-mdx":["/component---src-pages-resume-index-mdx-b74a871220eedc143340.js"],"component---src-pages-srd-index-mdx":["/component---src-pages-srd-index-mdx-33e474d758f30da9faa6.js"]};/*]]>*/</script><script src="/polyfill-4718f0fec20e0d09d7f5.js" nomodule=""></script><script src="/component---src-pages-blog-fun-with-types-units-of-measure-mdx-4df816fa74c3b8ffb6f0.js" async=""></script><script src="/app-d3640f62092642571bce.js" async=""></script><script src="/framework-a41a30b6052f08f79325.js" async=""></script><script src="/webpack-runtime-2eff1631cdf3f2eb40d3.js" async=""></script></body></html>